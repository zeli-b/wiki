<script src="https://cdn.jsdelivr.net/npm/cytoscape@3.32.0/dist/cytoscape.min.js"></script>

<div id="cy" style="width: 100%; height: 600px; display: block;"></div>

<script>

async function main() {
	const req = await fetch("/connection.json");
	const elements = await req.json();
	console.log(elements);
	
	const cy = cytoscape({
	    container: document.getElementById('cy'),
	    elements: elements,
	    style: [
	        {
	            selector: 'node',
	            style: {
	                label: 'data(name)',
	                "text-valign": "center",
	                "text-halign": "center",
	                width: "10px",
	                height: "10px",
	                "font-size": "6px"
	            }
	        },
	        {
	            selector: "edge",
	            style: {
	                width: "2px"
	            }
	        }
	    ],
	    layout: {
  name: 'fcose', // Fast Compound Spring Embedder

  // Quality & Performance
  quality: 'default', // 'default', 'proof' (slower but better quality) or 'draft' (faster but lower quality)
                      // For 500 nodes, 'default' is a good start. If too slow, try 'draft'.
  sampleSize: 150,    // (Default: 25) Number of nodes to sample for computing D-PSEUDOCENTERS.
                      // Increasing this might improve layout for larger, more complex graphs but costs more time.
                      // For 500 nodes, a slightly higher value than default might be beneficial. Experiment.

  // Node Separation
  nodeRepulsion: 4500,        // (Default: 4500) Higher values push nodes further apart.
                               // Good starting point, adjust if nodes are too cramped or too sparse.
  idealEdgeLength: 100,       // (Default: 50) Target edge length.
                               // For 500 nodes, a slightly larger idealEdgeLength might help with initial spacing.
  edgeElasticity: 0.45,       // (Default: 0.45) Controls how much edges can deviate from their ideal length.

  // Compound Node (if you have them)
  nestingFactor: 0.1,         // (Default: 0.1) Controls spacing for inter-graph edges.
  gravity: 80,                // (Default: 80 in fcose vs 0.25 in cose-bilkent) Pulls nodes towards the center.
                               // fcose's gravity scaling is different. This is a key parameter for compactness.
  gravityRange: 3.8,          // (Default: 3.8)
  gravityCompound: 1.0,       // (Default: 1.0)
  gravityRangeCompound: 1.5,  // (Default: 1.5)

  // Iterations & Animation
  numIter: 2500,              // (Default: 2500) Maximum iterations.
  animate: 'end',             // (Default: 'end') 'end', 'during', or false. 'end' is usually best for user experience.
  animationDuration: 500,     // (Default: 500)
  animationEasing: undefined,   // (Default: undefined) e.g., 'ease-out'

  // Packing & Tiling (for disconnected components or overall spacing)
  packComponents: true,       // (Default: true) Whether to pack disconnected components.
  tile: true,                 // (Default: true) Whether to tile disconnected components.
  tilingPaddingVertical: 20,  // (Default: 10) Increased padding can help if components are too close.
  tilingPaddingHorizontal: 20,// (Default: 10)

  // Other
  fit: true,                  // (Default: true) Fit graph to viewport after layout.
  padding: 50,                // (Default: 30) Padding around the graph when fitting. More padding can be nice.
  randomize: true,            // (Default: true) Randomize initial positions. Usually good.
  nodeDimensionsIncludeLabels: true, // (Default: false) Set to true if you want labels to be considered for node spacing to avoid overlaps.

  // Function-based parameters (for fine-grained control)
  // For advanced scenarios, you can define idealEdgeLength, nodeRepulsion, etc., as functions:
  // idealEdgeLength: function( edge ){ return 100; },
  // nodeRepulsion: function( node ){ return 6000; },
}

	})
}

main();
</script>